<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>Rickard's personal homepage: latest posts tagged motivation</title>
        <link>http://rickardlindberg.me</link>
        <description><![CDATA[Rickard's personal homepage: latest posts tagged motivation]]></description>
        <atom:link href="http://rickardlindberg.me/tags/motivation/rss.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Wed, 02 Aug 2023 00:00:00 UT</lastBuildDate>
        <item>
    <title>DevLog 008: How to overcome lack of motivation?</title>
    <link>http://rickardlindberg.me/writing/devlog-008-how-to-overcome-lack-of-motivation/</link>
    <description><![CDATA[<h1>DevLog 008: How to overcome lack of motivation?</h1>

<p><em>Published on  2 August 2023.</em></p>

<p>As I sit down this morning to continue work on my <a href="/projects/rlvideo/index.html">video editor</a>, I don’t feel motivated at all. I browse some code that I worked on yesterday, see problems with it, but can’t really see how to improve it. Everything feels complicated, and I don’t feel like programming at all.</p>
<p>What to do?</p>
<p>Well, this is just a hobby project of mine. I could just do something else today. But let’s pretend that it’s not. After all, I still have a desire to make progress on this project.</p>
<h2 id="options">Options</h2>
<p>Generally speaking, I can make two types of changes to the code:</p>
<ul>
<li>Refactoring to improve the design.</li>
<li>Adding a feature to improve the product.</li>
</ul>
<p>Yesterday, I spent most of the day refactoring and designing. I still feel that the design needs improvements in the area that I worked on, but I find that extra hard to motivate myself to work on today.</p>
<p>And perhaps that is also the wrong thing to do? Yesterday I improved the design a little to the point where fixing an actual problem was easier. Shouldn’t that be enough?</p>
<p>If we keep improving a little bit for every feature we work on, we never have to exclusively work on refactoring.</p>
<p>When I write that, it makes sense to me. I should practice feeling content with having made some improvements. I should practice not striving for perfection.</p>
<h2 id="how-to-improve-the-product">How to improve the product?</h2>
<p>So how can we improve the product? What is something that we can add that makes it easier, more pleasant, or more efficient for me to edit footage?</p>
<p>Yesterday I was annoyed by proxy clip loading time. I am still annoyed by that, but I have a feeling it will be a little difficult to fix. And I don’t feel up for it this morning.</p>
<p>Is there something easier that we can work on?</p>
<p>Yes, there is!</p>
<p>One common thing that happens when I shoot is that some clips turn out to be complete garbage. I might have pressed the record button by mistake or I might have an out of focus shot. In those cases I just want to discard the clip.</p>
<p>Say that clip <code>C0015.MP4</code> below is out of focus.</p>
<p>
<center>
<img src="discard.png" title="fig:" alt="Out of focus clip that I want to discard." />
</center>
</p>
<p>I want to open up the context menu for that cut and choose “ripple delete”. It should remove that cut from the timeline and move all cuts to the right of it left to fill up the space.</p>
<p>If we add this feature, I can actually start editing some footage. Because that is how I usually edit videos. I drop all clips on the timeline and then I cut things apart and make it shorter. With this new feature, I still can’t make any cuts, but I can discard clips.</p>
<h2 id="clips-and-cuts-again">Clips and cuts again</h2>
<p>I keep mixing the words clip and cut. A clip means a file on disk. When a clip is added to the timeline, a cut is created that spans the whole region of the clip. So in the beginning, the clip and the cut is of equal length. However, the cut can change in and out points of the clip, making it shorter.</p>
<h2 id="approach">Approach</h2>
<p>I will try to go slowly when working on this feature and pay attention to the design as I go along.</p>
<p>I will try to make small refactorings to improve the design along the way, but the focus will still be to implement this feature.</p>
<p>Let’s get started.</p>
<h2 id="starting-point">Starting point</h2>
<p>Let’s start with the context menu for a cut.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">class</span> CutAction(Action):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    ...</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    <span class="kw">def</span> right_mouse_down(<span class="va">self</span>, x, y, gui):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>        <span class="kw">def</span> mix_strategy_updater(value):</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>            <span class="kw">def</span> update():</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>                <span class="cf">with</span> <span class="va">self</span>.project.new_transaction() <span class="im">as</span> transaction:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>                    transaction.modify(<span class="va">self</span>.cut.<span class="bu">id</span>, <span class="kw">lambda</span> cut:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>                        cut.with_mix_strategy(value))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>            <span class="cf">return</span> update</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>        gui.show_context_menu([</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>            MenuItem(label<span class="op">=</span><span class="st">&quot;over&quot;</span>, action<span class="op">=</span>mix_strategy_updater(<span class="st">&quot;over&quot;</span>)),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>            MenuItem(label<span class="op">=</span><span class="st">&quot;under&quot;</span>, action<span class="op">=</span>mix_strategy_updater(<span class="st">&quot;under&quot;</span>)),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>        ])</span></code></pre></div>
<p>Aha, we are back to the <code>CutAction</code> that we worked on in the previous DevLog. This is an opportunity to make design improvements to it while still focusing on the new ripple delete feature.</p>
<p>Making design improvements is always easier when we have tests, and it is many times my preferred way of adding new functionality. So let’s start there. This is what I come up with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="co">I show a menu item for ripple delete:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; project = None</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; cut = None</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; scrollbar = None</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action = CutAction(project, cut, scrollbar)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; gui = TestGui()</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action.right_mouse_down(x=None, y=None, gui=gui)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; gui.print_context_menu_items()</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="co">over</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="co">under</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="co">ripple delete</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>At this point, I just want to assert that we have a ripple delete menu item.</p>
<p>I null out any parameters that are not used.</p>
<p>To make this test run, I also have to extend <code>TestGui</code> with <code>print_context_menu_items</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">diff --git a/rlvideolib/gui/testing.py b/rlvideolib/gui/testing.py</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>index aaba74d..0df0dda 100644</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="dt">--- a/rlvideolib/gui/testing.py</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="dt">+++ b/rlvideolib/gui/testing.py</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="dt">@@ -4,7 +4,12 @@ class TestGui:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>         self.click_context_menu = click_context_menu</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>     def show_context_menu(self, menu):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="va">+        self.last_context_menu = menu</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>         for item in menu:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>             if item.label == self.click_context_menu:</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>                 item.action()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>                 return</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="va">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a><span class="va">+    def print_context_menu_items(self):</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="va">+        for item in self.last_context_menu:</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="va">+            print(item.label)</span></span></code></pre></div>
<p>Let’s make it pass:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="dt">@@ -290,6 +305,7 @@ class CutAction(Action):</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>         gui.show_context_menu([</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>             MenuItem(label=&quot;over&quot;, action=mix_strategy_updater(&quot;over&quot;)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>             MenuItem(label=&quot;under&quot;, action=mix_strategy_updater(&quot;under&quot;)),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="va">+            MenuItem(label=&quot;ripple delete&quot;, action=lambda: None),</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>         ])</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>     def mouse_up(self):</span></code></pre></div>
<p>Just enough to make the test pass. We now have a context menu item that will do nothing when we click on it.</p>
<pre><code>$ ./make.py commit -m &#39;New ripple delete context menu item that does nothing.&#39;
.....................................................
----------------------------------------------------------------------
Ran 53 tests in 2.893s

OK
[main 2659383] New ripple delete context menu item that does nothing.
 2 files changed, 21 insertions(+)</code></pre>
<h2 id="moving-slowly">Moving slowly</h2>
<p>The <code>TestGui</code> that we had to modify for this test lives in the <code>rlvideolib.gui.testing</code> module. The <code>rlvideolib.gui</code> package looks like this:</p>
<pre><code>rlvideolib/gui
├── framework.py
├── generic.py
├── gtk.py
├── __init__.py
└── testing.py</code></pre>
<p>We recently extracted the framework module. It contains framework related GUI code that does not depend on GTK and does not depend on our application. It makes sense for a framework to include facilities to help testing, right?</p>
<p>Let’s get rid of the testing module and move its contents to the framework module.</p>
<pre><code>$ ./make.py commit -m &#39;Move TestGui to rlvideolib.gui.framework and get rid of the testing module.&#39;
.....................................................
----------------------------------------------------------------------
Ran 53 tests in 2.896s

OK
[main 3ea95fc] Move TestGui to rlvideolib.gui.framework and get rid of the testing module.
 4 files changed, 21 insertions(+), 3 deletions(-)
 rename rlvideolib/gui/{testing.py =&gt; framework.py} (58%)</code></pre>
<p>We have made small progress towards the ripple delete feature and made the code base a little cleaner by indicating that test helpers are part of the GUI framework. Nice!</p>
<p>I feel much more motivated now than when I got started. But before I move on, I will take a break and have some breakfast.</p>
<h2 id="back-to-the-test">Back to the test</h2>
<p>Let’s go back to the test. This is what we have:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; project = None</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; cut = None</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; scrollbar = None</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action = CutAction(project, cut, scrollbar)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; gui = TestGui()</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action.right_mouse_down(x=None, y=None, gui=gui)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; gui.print_context_menu_items()</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a><span class="co">over</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a><span class="co">under</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a><span class="co">ripple delete</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>That feels like a lot of set up to me. And many of the parameters are <code>None</code>.</p>
<p>I take a closer look at the x and y coordinates. As far as I can tell, no action is using those in the <code>right_mouse_down</code> method. Let’s get rid of them.</p>
<pre><code>$ ./make.py commit -m &#39;Get rid of x and y coordinates in Action.right_mouse_down since they are never used.&#39;
.....................................................
----------------------------------------------------------------------
Ran 53 tests in 3.403s

OK
[main 2c4c80e] Get rid of x and y coordinates in Action.right_mouse_down since they are never used.
 3 files changed, 4 insertions(+), 4 deletions(-)</code></pre>
<p>Let’s further refactor the test to this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="co">I show cut menu items on right click:</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; gui = TestGui()</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action = CutAction(project=None, cut=None, scrollbar=None)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action.right_mouse_down(gui=gui)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; gui.print_context_menu_items()</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a><span class="co">over</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a><span class="co">under</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a><span class="co">ripple delete</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>This indicates that the showing of the menu does not depend on the project, cut, or scrollbar. I think that it reads quite nicely.</p>
<pre><code>$ ./make.py commit -m &#39;Change cut action test to be assertion for menu items shown.&#39;
.....................................................
----------------------------------------------------------------------
Ran 53 tests in 3.411s

OK
[main 1708e0c] Change cut action test to be assertion for menu items shown.
 1 file changed, 2 insertions(+), 5 deletions(-)</code></pre>
<p>Now we need a new test for clicking the ripple delete menu item.</p>
<h2 id="ripple-delete-test">Ripple delete test</h2>
<p>I write this test:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="co">I ripple delete:</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; gui = TestGui(click_context_menu=&quot;ripple delete&quot;)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action = CutAction(project=None, cut=None, scrollbar=None)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; action.right_mouse_down(gui=gui)</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a><span class="co">do ripple delete</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>That is, I assert that “do ripple delete” is printed when we press that menu item. Baby steps.</p>
<p>I make it pass like this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="dt">@@ -299,10 +306,12 @@ class CutAction(Action):</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>                     transaction.modify(self.cut.id, lambda cut:</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>                         cut.with_mix_strategy(value))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>             return update</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="va">+        def ripple_delete():</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a><span class="va">+            print(&quot;do ripple delete&quot;)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>         gui.show_context_menu([</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>             MenuItem(label=&quot;over&quot;, action=mix_strategy_updater(&quot;over&quot;)),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>             MenuItem(label=&quot;under&quot;, action=mix_strategy_updater(&quot;under&quot;)),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a><span class="st">-            MenuItem(label=&quot;ripple delete&quot;, action=lambda: None),</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a><span class="va">+            MenuItem(label=&quot;ripple delete&quot;, action=ripple_delete),</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a>         ])</span></code></pre></div>
<pre><code>$ ./make.py commit -m &#39;Add non-empty action for ripple delete.&#39;
.....................................................
----------------------------------------------------------------------
Ran 53 tests in 2.909s

OK
[main 4c4e272] Add non-empty action for ripple delete.
 1 file changed, 10 insertions(+), 1 deletion(-)</code></pre>
<h2 id="the-next-step">The next step</h2>
<p>Let’s take the next step and assert that it actually does a ripple delete.</p>
<p>I modify the test to this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="co">I ripple delete:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; from rlvideolib.domain.project import Project</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; project = Project.new()</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; with project.new_transaction() as transaction:</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a><span class="co">...     hello_id = transaction.add_text_clip(&quot;hello&quot;, length=10, id=&quot;A&quot;)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a><span class="co">...     _        = transaction.add_text_clip(&quot;there&quot;, length=10, id=&quot;B&quot;)</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; project.split_into_sections().to_ascii_canvas()</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a><span class="co">|&lt;-A0-----&gt;&lt;-B0-----&gt;|</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; CutAction(</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a><span class="co">...     project=project,</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a><span class="co">...     cut=project.project_data.get_cut(hello_id),</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a><span class="co">...     scrollbar=None</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a><span class="co">... ).right_mouse_down(</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a><span class="co">...     gui=TestGui(click_context_menu=&quot;ripple delete&quot;)</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a><span class="co">... )</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a><span class="co">&gt;&gt;&gt; project.split_into_sections().to_ascii_canvas()</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a><span class="co">|&lt;-B0-----&gt;|</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>This got quite messy. Let’s see if we can break it down. First we setup a new project with two clips next to each other. Then we simulate that the ripple delete menu item is clicked and assert that the first clip is removed and the second clip is moved to the beginning.</p>
<p>The setup of the project is kind of messy. For example, we have to do the import in the doctest to prevent a circular import. And we reach in to grab the project data to get the cut.</p>
<p>There are many things to improve here.</p>
<p>But I think I want to move on and get it to pass. We’ll get back to the issues above. I promise.</p>
<p>I make this change:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>         def ripple_delete():</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="st">-            print(&quot;do ripple delete&quot;)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="va">+            self.project.ripple_delete(self.cut.id)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>         gui.show_context_menu([</span></code></pre></div>
<p>That tells me that ‘Project’ object has no attribute ‘ripple_delete’.</p>
<p>I add it like this:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="kw">class</span> Project:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>    ...</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>    <span class="kw">def</span> ripple_delete(<span class="va">self</span>, cut_id):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>        <span class="cf">with</span> <span class="va">self</span>.new_transaction() <span class="im">as</span> transaction:</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>            transaction.ripple_delete(cut_id)</span></code></pre></div>
<p>That tells med that ‘Transaction’ object has no attribute ‘ripple_delete’.</p>
<p>We’re getting closer.</p>
<p>I can’t come up with the general solution for ripple delete, so I hard code a solution for the particular case where we only have two cuts in the project:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">class</span> Transaction:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>    ...</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>    <span class="kw">def</span> ripple_delete(<span class="va">self</span>, cut_id):</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>        data <span class="op">=</span> <span class="va">self</span>.project.project_data</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>        data <span class="op">=</span> data.remove_cut(cut_id)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>        data <span class="op">=</span> data.modify_cut(<span class="bu">list</span>(data.cuts.cut_map.keys())[<span class="dv">0</span>], <span class="kw">lambda</span> cut: cut.move(<span class="op">-</span><span class="dv">10</span>))</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>        <span class="va">self</span>.project.set_project_data(data)</span></code></pre></div>
<p>And also make a quick and dirty version of <code>remove_cut</code>.</p>
<pre><code>$ ./make.py commit -m &#39;Quick and dirty version of ripple delete that works in one case.&#39;
.....................................................
----------------------------------------------------------------------
Ran 53 tests in 3.902s

OK
[main 7ba45c9] Quick and dirty version of ripple delete that works in one case.
 2 files changed, 43 insertions(+), 5 deletions(-)</code></pre>
<p>Here is the example project:</p>
<p>
<center>
<img src="ripple1.png" title="fig:" alt="Before ripple delete." />
</center>
</p>
<p>If we try to ripple delete the first clip in the GUI, we get this:</p>
<p>
<center>
<img src="ripple2.png" title="fig:" alt="After ripple delete." />
</center>
</p>
<p>Not quite right, but it shows progress in the right direction.</p>
<p>I think we can leave the cut action test alone for a while now. It is fine. Now we need to turn our attention to the ripple delete method in the transaction and make it work as intended.</p>
<h2 id="generalizing-ripple-delete">Generalizing ripple delete</h2>
<p>The project has a hierarchy of classes representing the different parts. The ripple delete only affects the cuts. I make that clear by just forwarding <code>ripple_delete</code> calls until we get to <code>Cuts</code>.</p>
<p>Transaction forwards to project data:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">class</span> Transaction:</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>    ...</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a>    <span class="kw">def</span> ripple_delete(<span class="va">self</span>, cut_id):</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a>        <span class="va">self</span>.project.set_project_data(<span class="va">self</span>.project.project_data.ripple_delete(cut_id))</span></code></pre></div>
<p>And project data forwards to cuts:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="kw">class</span> ProjectData(namedtuple(<span class="st">&quot;ProjectData&quot;</span>, <span class="st">&quot;sources,cuts&quot;</span>)):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>    ...</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>    <span class="kw">def</span> ripple_delete(<span class="va">self</span>, cut_id):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">self</span>._replace(cuts<span class="op">=</span><span class="va">self</span>.cuts.ripple_delete(cut_id))</span></code></pre></div>
<p>And finally, the hard coded ripple delete is here:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="kw">class</span> Cuts(namedtuple(<span class="st">&quot;Cuts&quot;</span>, <span class="st">&quot;cut_map,region_to_cuts,region_group_size&quot;</span>)):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>    ...</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a>    <span class="kw">def</span> ripple_delete(<span class="va">self</span>, cut_id):</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a>        data <span class="op">=</span> <span class="va">self</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a>        data <span class="op">=</span> data.remove(cut_id)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a>        data <span class="op">=</span> data.modify(<span class="bu">list</span>(data.cut_map.keys())[<span class="dv">0</span>], <span class="kw">lambda</span> cut: cut.move(<span class="op">-</span><span class="dv">10</span>))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a>        <span class="cf">return</span> data</span></code></pre></div>
<pre><code>$ ./make.py commit -m &#39;Move ripple_delete down to Cuts.&#39;
.....................................................
----------------------------------------------------------------------
Ran 53 tests in 3.397s

OK
[main c5deb77] Move ripple_delete down to Cuts.
 2 files changed, 10 insertions(+), 7 deletions(-)</code></pre>
<p>If we can just get that one working properly, I think our feature is done.</p>
<h2 id="endless-sidetracks">Endless sidetracks?</h2>
<p>Implementing the ripple delete was much more difficult than I expected. I feel like I hit problem after problem that I need to solve before I can actually get to the ripple delete. I get tired and demotivated again.</p>
<p>Let’s recap what’s left on our imaginary TODO list.</p>
<p>First there is the issue of the messy cut action test, where it was particularly painful to setup a project.</p>
<p>And then there is the ripple delete in cuts that is not fully implemented.</p>
<p>I actually think that is it.</p>
<p>Not as much as I felt it was. Writing it down helped me realize that.</p>
<p>I think both of them might be a little difficult and take some time. Instead of documenting them in detail, I will just report on the status once done.</p>
<h2 id="report">Report</h2>
<p>I managed to generalize ripple delete and add some tests for it.</p>
<p>I’m not sure it’s perfect, but we can improve it later with the help of test. I’m sure it is not harmful at least.</p>
<p>However, it brings up another question. What if we do a ripple delete on the wrong clip? How to recover from that? The answer right now is that we can’t. Therefore, I think an undo function is high on the priority list. It should be relatively straight forward to implement thanks to the immutable data structures.</p>
<p>When it comes to the project setup, I just didn’t have the energy to do anything about it. I know this project setup is done in a few test, so I’m sure we will come across it later. Hopefully I have a better idea for how to improve it then. And some more energy. I’m OK leaving it like this. I don’t think we have made things worse. So much for a promise to get back to it.</p>
<h2 id="summary">Summary</h2>
<p>This change took longer than expected in part because the design was not clean enough in a few places, and in part because the project was lacking methods for modifying cuts because there had been no need for it.</p>
<p>We cleaned up the design in a few places add added a bit more functionality for project editing operations.</p>
<p>Next time we work in this area, I think we can move faster.</p>
<p>Is this evolutionary design?</p>
<p>This also gets me thinking about stories and estimating stories and how that does not make sense in this context. If things get easier and easier to implement over time, that would also mean that time to complete a story takes less and less time. So you can’t really estimate multiple stories, because the estimate changes once the previous story is completed. At least if stories somewhat overlap it terms of changes in the code base.</p>
]]></description>
    <pubDate>Wed, 02 Aug 2023 00:00:00 UT</pubDate>
    <guid>http://rickardlindberg.me/writing/devlog-008-how-to-overcome-lack-of-motivation/</guid>
    <dc:creator>Rickard Lindberg</dc:creator>
</item>

    </channel>
</rss>
